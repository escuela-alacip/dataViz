---
bibliography: reproviz.bib
---

<center><img src="http://alacip.org/wp-content/uploads/2014/03/logoEscalacip1.png" width="500"></center>


<center> <h1>Curso: Visualización de Datos con enfoque reproducible de Data Science</h1> </center>

<br></br>

* Profesor:  <a href="http://www.pucp.edu.pe/profesor/jose-manuel-magallanes/" target="_blank">Dr. José Manuel Magallanes, PhD</a> ([jmagallanes@pucp.edu.pe](mailto:jmagallanes@pucp.edu.pe))<br>
    - Profesor del **Departamento de Ciencias Sociales, Pontificia Universidad Católica del Peru**.<br>
    - Senior Data Scientist del **eScience Institute** and Visiting Professor at **Evans School of Public Policy and Governance, University of Washington**.<br>
    - Fellow Catalyst, **Berkeley Initiative for Transparency in Social Sciences, UC Berkeley**.


## De R a la web: Caso Espacial.

En este ejercicio publicaremos en la web un mapa. Haremos una versión estática y otra interactiva.  



1. **Preparando el archivo de Mapa**

* Descargue de este [link](https://app.box.com/s/mdcqfue3u0wis0b3v4gy0kwcjv4e0amu) la carpeta con el mapa, guardelo en su computadora.
* Descomprima la carpeta. Los archivos crean un mapa de formato shapefile. Un mapa shapefile es complicado leer desde la nube, pues es un conjunto de archivos.
* Cambie el mapa a formato **JSON**. Para ello vaya al [mapshaper](https://mapshaper.org/); desde ahí, suba los archivos de la carpeta, simplifiquelo, y luego exportelo como _topojson_. 
* Suba el archivo _topojson_ a Github. 
* Guarde el link de descarga del archivo subido.

2. **Versión estática**

* Traiga el mapa desde GitHub, necesita tener instaladas las bibliotecas _sp_, _geojsonio_ y _rgdal_:

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}

library(sp)
library(geojsonio)
library(rgdal)

fromGit="https://github.com/escuela-alacip/dataViz/raw/master/data/seattle.json"

wazipMap <- rgdal::readOGR(fromGit)
```

Puede ver el mapa aquí:
```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
plot(wazipMap)
```

* Decida qué va a graficar:

El mapa presenta un poligono por cada zipcode. La idea es colorear cada poligono. Normalmente la data que uno desea colorear está en otro archivo. Ese archivo está aquí:

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
fromGit2="https://github.com/escuela-alacip/dataViz/raw/master/data/contriWA_2016.RData"

# lo traemos asi:
load(file=url(fromGit2))
```


Tenemos:

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
str(contriWA_2016,width = 60, strict.width = 'cut')
```

Esta data informa cuánto han contribuido diferentes personas a candidaturas políticas. Está por persona, NO por ZIP, entonces haremos un cálculo por zip. Por ejemplo, el promedio contribuido por zip:

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
# similar and saving space:
columnToAggregate=contriWA_2016$amount

# new ROW:
newROW_UNIT=list(zipCode=contriWA_2016$contributor_zip)

WA_zip_contri=with(contriWA_2016, 
                   aggregate(columnToAggregate, 
                             by=newROW_UNIT, 
                             mean)) #mean per zip code 

names(WA_zip_contri)[2]='AVE_Amount'
# obteniendo:

head(WA_zip_contri)
```

* Combine la información con el mapa:

Nuestro mapa tiene estas variables:

```{r}
names(wazipMap)
```

El zip code de cada poligono está en _ZCTA5CE10_. Esa servirá para el _merge_:

```{r}
merge(wazipMap,WA_zip_contri,by.x='ZCTA5CE10', by.y='zipCode')
```


______

**AUSPICIO**: 

* El desarrollo de estos contenidos ha sido posible gracias al grant del Berkeley Initiative for Transparency in the Social Sciences (BITSS) at the Center for Effective Global Action (CEGA) at the University of California, Berkeley


<center>
<img src="https://www.bitss.org/wp-content/uploads/2015/07/bitss-55a55026v1_site_icon.png" style="width: 200px;"/>
</center>

* Este curso cuenta con el auspicio de:


<center>
<img src="https://www.python.org/static/img/psf-logo@2x.png" style="width: 500px;"/>
</center>



**RECONOCIMIENTO**


EL Dr. Magallanes agradece a la Pontificia Universidad Católica del Perú, por su apoyo en la participación en la Escuela ALACIP.

<center>
<img src="https://dci.pucp.edu.pe/wp-content/uploads/2014/02/Logotipo_colores-290x145.jpg" style="width: 400px;"/>
</center>


El autor reconoce el apoyo que el eScience Institute de la Universidad de Washington le ha brindado desde el 2015 para desarrollar su investigación en Ciencia de Datos.

<center>
<img src="https://escience.washington.edu/wp-content/uploads/2015/10/eScience_Logo_HR.png" style="width: 500px;"/>
</center>

<br>

